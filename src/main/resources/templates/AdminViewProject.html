<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin View Projects - Gajmor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Icons -->
    <link rel="icon" href="Images/GajmorLogo.png">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/linearicons.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/magnific-popup.css">
    <link rel="stylesheet" href="/css/nice-select.css">
    <link rel="stylesheet" th:href="@{/css/main.css}">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0"></script>

    <style>

        body {
            margin:0;
            padding:0;
<!--            background:#0d0d0d;-->
            color:white;
            font-family:"Montserrat",sans-serif;
        }

        .page-title {
            text-align:center;
            font-size:32px;
            color:#ffae00;
            font-weight:700;
            margin-bottom:25px;
            animation:fadeDown .5s ease;
        }
        @keyframes fadeDown {
            from { opacity:0; transform:translateY(-20px); }
            to { opacity:1; transform:translateY(0); }
        }

        .project-grid {
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(290px,1fr));
            gap:22px;
            padding:20px;
            width:90%;
            margin:auto;
            animation:fadeIn .6s ease;
        }

        @keyframes fadeIn {
            from { opacity:0; }
            to { opacity:1; }
        }

        .project-card {
            background:rgba(255,255,255,0.05);
            border:1px solid rgba(255,255,255,0.12);
            backdrop-filter:blur(8px);
            border-radius:18px;
            overflow:hidden;
            box-shadow:0 4px 20px rgba(0,0,0,0.35);
            transition:.35s ease;
            animation:fadeUp .5s ease;
        }

        @keyframes fadeUp {
            from { opacity:0; transform:translateY(20px); }
            to { opacity:1; transform:translateY(0); }
        }

        .project-card:hover {
            transform:scale(1.04);
            border-color:#ffae00;
            box-shadow:0 0 25px rgba(255,174,0,0.45);
        }

        .project-card img {
            width:100%;
            height:190px;
            object-fit:cover;
        }

        .project-title {
            text-align:center;
            padding:12px;
            font-weight:700;
            font-size:18px;
            color:white;
        }

        .card-actions {
            padding:12px;
            display:flex;
            justify-content:space-between;
        }

        .btn {
            border:none;
            padding:8px 14px;
            border-radius:10px;
            cursor:pointer;
            font-weight:600;
            transition:.3s ease;
            font-size:14px;
        }

        .view-btn { background:#ffae00; color:black; }
        .edit-btn { background:#3498db; color:white; }
        .delete-btn { background:#e74c3c; color:white; }

        .delete-btn:hover { background:#c0392b; }
        .edit-btn:hover { background:#227cbf; }
        .view-btn:hover { filter:brightness(1.1); }

        .modal {
            position:fixed;
            inset:0;
            background:rgba(0,0,0,0.7);
            display:none;
            justify-content:center;
            align-items:center;
            z-index:2000;
            backdrop-filter:blur(8px);
        }

        .modal-content {
            padding: 35px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .modal-content h2 {
            text-align: center;
            font-size: 30px;
            letter-spacing: 1px;
            color: #000000;
            margin-bottom: 10px;
        }




        <!--.modal-content {
            background:#c8c8c8;
            border:1px solid rgba(255,255,255,0.15);
            padding:25px;
            width:95%;
            max-width:900px;
            max-height:90vh;
            overflow-y:auto;
            border-radius:16px;
            animation:pop .4s ease;
        }-->

        @keyframes pop {
            from { opacity:0; transform:scale(.85); }
            to { opacity:1; transform:scale(1); }
        }

        .close-btn {
            background:#ff3b3b;
            color:white;
            border:none;
            padding:8px 16px;
            float:right;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        }

        .modal-content p {
    font-size: 15px;
    color: #000000;
    line-height: 1.6;
}

.modal-content strong {
    color: #000000;
    font-weight: 600;
}

       .image-preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 16px;
    padding: 16px;
    background: rgba(255,255,255,0.03);
    border-radius: 16px;
}

.image-preview img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    transition: transform 0.35s ease, box-shadow 0.35s ease;
}

.image-preview img:hover {
    transform: scale(1.08);
    box-shadow: 0 12px 35px rgba(255,174,0,0.4);
}


        .image-box button {
            position:absolute;
            top:8px;
            right:8px;
            background:#e74c3c;
            color:white;
            border:none;
            border-radius:50%;
            width:25px;
            height:25px;
        }

        input, textarea {
            width:100%;
            padding:12px;
            margin-bottom:12px;
            border-radius:10px;
            border:none;
            background:#1d1d1d;
            color:white;
        }

        textarea { height:150px; resize:none; }

        label { color:#ffae00; font-weight:600; }


        .project-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px 50px;
    margin-top: 20px;
}

.detail {
    display: grid;
    grid-template-columns: 110px 1fr;
    align-items: start;
}

.detail strong {
    color: #007173;
    font-weight: 400;
    font-size: x-large;
}

.detail span {
    color: #000000;
    line-height: 1.6;
    font-size: 1 rem;
    font-weight: 800;
    margin-left: 40px;
}

/* Description takes full width */
.detail.full {
    grid-column: 1 / -1;
}



<!--        buttons-->

        .buttons {
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    margin-top: 25px;
}

#btn1{
    margin-right:20%;
}

#btn2{
    margin-left:20%;
}

.buttons button {
    width:200px;
    padding: 10px 22px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    transition: 0.3s ease;
}

.buttons button:hover {
    transform: translateY(-2px);
}


        .modal-content::-webkit-scrollbar {
    width: 6px;
}

.modal-content::-webkit-scrollbar-thumb {
    background: linear-gradient(#ffae00, #ff8800);
    border-radius: 10px;
}

        @media (max-width: 600px) {
    .modal-content p {
        grid-template-columns: 1fr;
    }

    .modal-content p strong {
        margin-bottom: 4px;
    }

    .buttons {
        flex-direction: column;
        gap: 12px;
    }

    .buttons button {
        width: 100%;
    }
}


        .image-box {
    position: relative;
    overflow: hidden;
    border-radius: 14px;
}

/* Delete button */
.image-box button {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: none;
    background: rgba(231, 76, 60, 0.9);
    color: #fff;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    transition: all 0.25s ease;
}

/* Hover effect */
.image-box button:hover {
    background: #c0392b;
    transform: scale(1.1);
}

        .image-box button {
    opacity: 0;
    transform: scale(0.8);
}

.image-box:hover button {
    opacity: 1;
    transform: scale(1);
}


        /* Default (Desktop) */
.modal-actions {
    display: flex;
    gap: 14px;
    margin-top: 22px;
}

/* Common button style */
.modal-actions button {
    flex: 1;
    padding: 12px 20px;
    border-radius: 14px;
    font-size: 15px;
    font-weight: 600;
    border: none;
    cursor: pointer;
}

/* Close */
.close-btn {
    background: #2c2c2c;
    color: #fff;
}

/* Save */
.view-btn {
    background: linear-gradient(135deg, #ffae00, #ff8c00);
    color: #000;
}

/* ðŸ“± MOBILE FIXED BOTTOM BUTTONS */
@media (max-width: 600px) {

    .modal-actions {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #c8c8c8;
        padding: 12px 16px;
        border-top: 1px solid rgba(255,255,255,0.12);
        display: flex;
        gap: 12px;
        z-index: 3000;
    }

    /* Prevent content hiding behind buttons */
    .modal-content {
        padding-bottom: 90px;
    }

    .modal-actions button {
        width: 100%;
        border-radius: 12px;
    }
}


    </style>

</head>

<body>

<!-- HEADER -->
<header class="default-header">
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand"><h1 style="color:white;">Gajmor</h1></a>
            <button class="navbar-toggler"><span class="fa fa-bars"></span></button>
            <div class="collapse navbar-collapse justify-content-end align-items-center">
                <ul class="navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/aboutUs">About</a></li>
                    <li><a href="/services">Services</a></li>
                    <li><a href="/view-pro">Projects</a></li>
                    <li><a href="/viewBlogs">Blog</a></li>
                    <li><a href="/jobs">careers</a></li>
                    <li><a href="/enquiry">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<!-- Start top-section Area -->
<section class="banner-area relative">
    <div class="overlay overlay-bg"></div>
    <div class="container">
        <div class="row justify-content-between align-items-center text-center banner-content">
            <div class="col-lg-12">
                <h1 class="text-white">Admin View Projects</h1>
                <p>Explore our latest commercial and residential project portfolio.</p>
            </div>
        </div>
    </div>
</section>
<!-- End top-section Area -->

<!-- GRID -->
<div class="project-grid" id="projectGrid"></div>

<!-- VIEW MODAL -->
<div class="modal" id="viewModal">
    <div class="modal-content">


        <h2 id="viewTitle" ></h2>
        <div id="viewImages" class="image-preview"></div>

        <div class="project-details">
            <div class="detail">
                <strong>Location: <label style="color:red;"> *</label></strong>
                <span id="viewLocation"></span>
            </div>

            <div class="detail">
                <strong>Area: <label style="color:red;"> *</label></strong>
                <span id="viewArea"></span>
            </div>

            <div class="detail full">
                <strong >Description: <label style="color:red;"> *</label></strong>
                <span id="viewDescription" style="font-size:15px;font-weight: 500;"></span>
            </div>
        </div>

        <div class="buttons">
            <button class="close-btn" id="btn1" onclick="closeModal('viewModal')">Close</button>
            <button class="edit-btn" id="btn2" onclick="switchToEdit()">Edit This Project</button>
        </div>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal" id="editModal">
    <div class="modal-content">



        <h2>Edit Project</h2>

        <form id="editProjectForm">

            <input type="hidden" id="projectId">

            <label>Project Name <label style="color:red;"> *</label></label>
            <input type="text" id="projectName">

            <label>Project Type <label style="color:red;"> *</label></label>
            <input type="text" id="projectType">

            <label>Location <label style="color:red;"> *</label></label>
            <input type="text" id="projectLocation">

            <label>Area <label style="color:red;"> *</label></label>
            <input type="text" id="projectArea">

            <label>Description <label style="color:red;"> *</label></label>
            <textarea id="projectDescription" maxlength="4000"></textarea>

            <label>Existing Images</label>
            <div id="editImages" class="image-preview"></div>

            <label>Add More Images</label>
            <input type="file" id="newImages" multiple>

            <div class="modal-actions">
                <button class="close-btn" onclick="closeModal('editModal')">Close</button>
                <button type="button" onclick="saveProject()" class="view-btn">
                    Save Changes
                </button>
            </div>

        </form>
    </div>
</div>



<script>

    /* SOFT SUCCESS SOUND */
    const successSound = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
    successSound.volume = 0.7;

    /* CONFETTI */
    function fireConfetti() {
        confetti({
            particleCount:150,
            spread:70,
            origin:{ y:0.6 }
        });
    }

    /* PREMIUM SUCCESS POPUP */
    function premiumSuccess(msg) {
        successSound.play();
        fireConfetti();

        Swal.fire({
            title: "Success!",
            html: `<b>${msg}</b>`,
            icon: "success",
            background: "#111",
            color: "white",
            showConfirmButton: false,
            timer: 1800,
            customClass: {
                popup: "animate__animated animate__slideInDown"
            }
        });
    }

    /* DELETE CONFIRM POPUP */
    function premiumDelete(msg) {
        successSound.play();

        Swal.fire({
            title: "Deleted!",
            html: `<b>${msg}</b>`,
            icon: "error",
            background: "#1a0000",
            color: "white",
            showConfirmButton: false,
            timer: 1500
        });
    }

    /* LOAD PROJECTS */
    fetch('/projects/list')
        .then(res => res.json())
        .then(projects => {
            const grid = document.getElementById('projectGrid');

            projects.forEach(project => {
                let card = document.createElement('div');
                card.classList.add('project-card');

                const firstImage = project.images.length > 0
                    ? `/uploads/${project.images[0].imagePath}`
                    : 'https://via.placeholder.com/400x250?text=No+Image';

                card.innerHTML = `
                    <img src="${firstImage}">
                    <div class="project-title">${project.name}</div>
                    <div class="card-actions">
                        <button class="btn view-btn" onclick='openViewModal(${JSON.stringify(project)})'>View</button>
                        <button class="btn edit-btn" onclick='openEditModal(${JSON.stringify(project)})'>Edit</button>
                        <button class="btn delete-btn" onclick="deleteProject(${project.id})">Delete</button>
                    </div>
                `;

                grid.appendChild(card);
            });
        });

    /* OPEN VIEW */
    let currentProject = null;

    function openViewModal(project) {
        currentProject = project;

        document.getElementById('viewTitle').textContent = project.name;
        document.getElementById('viewLocation').textContent = project.location;
        document.getElementById('viewArea').textContent = project.area + ' sq.ft';
        document.getElementById('viewDescription').textContent = project.description;

        document.getElementById('viewImages').innerHTML =
            project.images.map(img => `<img src="/uploads/${img.imagePath}">`).join('');

        document.getElementById('viewModal').style.display = 'flex';
    }

    function switchToEdit() {
        closeModal("viewModal");
        openEditModal(currentProject);
    }

    /* OPEN EDIT */
    function openEditModal(project) {

        document.getElementById('projectId').value = project.id;
        document.getElementById('projectName').value = project.name;
        document.getElementById('projectType').value = project.projectType;
        document.getElementById('projectLocation').value = project.location;
        document.getElementById('projectArea').value = project.area;
        document.getElementById('projectDescription').value = project.description;

        let div = document.getElementById('editImages');
        div.innerHTML = "";

        project.images.forEach(img => {
            div.innerHTML += `
                <div class="image-box">
                    <img src="/uploads/${img.imagePath}">
                    <button
                        data-path="${img.imagePath}"
                        onclick="deleteImage(${project.id}, this.dataset.path, this)"
                    >Ã—</button>
                </div>
            `;
        });

        document.getElementById('editModal').style.display = 'flex';
    }

    function closeModal(id) {
        document.getElementById(id).style.display = "none";
    }

    /* SAVE PROJECT */
    function saveProject() {
        let id = document.getElementById('projectId').value;
        let fd = new FormData();

        fd.append("id", id);
        fd.append("name", document.getElementById('projectName').value);
        fd.append("projectType", document.getElementById('projectType').value);
        fd.append("location", document.getElementById('projectLocation').value);
        fd.append("area", document.getElementById('projectArea').value);
        fd.append("description", document.getElementById('projectDescription').value);

        let files = document.getElementById('newImages').files;
        for (let f of files) fd.append("images", f);

        fetch(`/projects/save`, { method:"POST", body:fd })
            .then(res => res.text())
            .then(() => {
                closeModal("editModal");
                premiumSuccess("Project updated successfully!");
                setTimeout(() => location.reload(), 1500);
            });
    }

    /* DELETE PROJECT */
    function deleteProject(id) {

        Swal.fire({
            title: "Are you sure?",
            text: "This project will be deleted permanently.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#e60000",
            cancelButtonColor: "#555",
            confirmButtonText: "Yes, delete it!"
        }).then(result => {
            if (result.isConfirmed) {

                fetch(`/projects/${id}`, { method:"DELETE" })
                    .then(() => {
                        premiumDelete("Project deleted!");
                        setTimeout(() => location.reload(), 1200);
                    });
            }
        });
    }

    /* DELETE IMAGE â€” FINAL FIX */
   	function deleteImage(projectId, imgPath, btn) {
	    if (confirm("Delete this image?")) {
	        fetch(`/projects/${projectId}/deleteImage?path=${encodeURIComponent(imgPath)}`, { method: "DELETE" })
	            .then(res => {
	                if (res.ok) {
	                    btn.parentElement.remove();
	                }
	            });
	    }
	}
</script>

<!-- FOOTER -->
<div th:replace="fragments/footer :: site-footer"></div>

<!-- Scripts -->
<script src="/js/vendor/jquery-2.2.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="/js/vendor/bootstrap.min.js"></script>
<script src="/js/jquery.ajaxchimp.min.js"></script>
<script src="/js/parallax.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/isotope.pkgd.min.js"></script>
<script src="/js/jquery.nice-select.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/jquery.sticky.js"></script>
<script src="/js/main.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>

</body>
</html>
