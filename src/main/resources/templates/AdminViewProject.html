	<!DOCTYPE html>
    <html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
	<meta charset="UTF-8">
	<title>View Projects</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
	body {
	    font-family: Arial, sans-serif;
	    background-color: #f5f5f5;
	    margin: 0;
	    padding: 0;
	}
	
	/* Project Grid */
	.project-grid {
	    display: grid;
	    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
	    gap: 20px;
	    padding: 20px;
	}
	
	/* Project Card */
	.project-card {
	    background: #fff;
	    border-radius: 12px;
	    overflow: hidden;
	    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	    transition: transform 0.3s ease, box-shadow 0.3s ease;
	    animation: fadeUp 0.5s ease-in-out;
	}
	.project-card:hover {
	    transform: translateY(-5px) scale(1.02);
	    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
	}
	.project-card img {
	    width: 100%;
	    height: 200px;
	    object-fit: cover;
	}
	.project-title {
	    padding: 12px;
	    font-weight: bold;
	    text-align: center;
	    font-size: 16px;
	    border-top: 1px solid #eee;
	}
	.card-actions {
	    display: flex;
	    justify-content: space-around;
	    padding: 10px;
	    border-top: 1px solid #eee;
	}
	.card-actions button {
	    padding: 6px 12px;
	    border: none;
	    border-radius: 6px;
	    cursor: pointer;
	    font-size: 14px;
	    transition: all 0.3s;
	}
	.view-btn { background: #2ecc71; color: #fff; }
	.view-btn:hover { background: #27ae60; }
	.edit-btn { background: #3498db; color: #fff; }
	.edit-btn:hover { background: #2c80b4; }
	.delete-btn { background: #e74c3c; color: #fff; }
	.delete-btn:hover { background: #c0392b; }
	
	/* Modal (View + Edit) */
	.modal {
	    position: fixed;
	    top: 0; left: 0;
	    width: 100%; height: 100%;
	    background: rgba(0,0,0,0.7);
	    display: none;
	    justify-content: center;
	    align-items: center;
	    backdrop-filter: blur(6px);
	    z-index: 1000;
	    padding: 15px;
	    animation: fadeIn 0.4s ease-in-out;
	}
	.modal-content {
	    background: #fff;
	    padding: 20px;
	    max-width: 900px;
	    width: 95%;
	    max-height: 90%;
	    border-radius: 12px;
	    overflow-y: auto;
	    position: relative;
	    animation: scaleUp 0.4s ease-in-out;
	}
	.close-btn {
	    position: absolute;
	    top: 15px; right: 20px;
	    background: #ff5555;
	    color: white;
	    border: none;
	    padding: 8px 14px;
	    cursor: pointer;
	    font-size: 14px;
	    border-radius: 6px;
	    transition: background 0.3s;
	}
	.close-btn:hover { background: #e33; }
	
	/* Image previews */
	.image-preview {
	    display: flex;
	    flex-wrap: wrap;
	    gap: 10px;
	    margin-bottom: 15px;
	}
	.image-preview img {
	    height: 150px;
	    border-radius: 8px;
	    transition: transform 0.3s;
	}
	.image-preview img:hover {
	    transform: scale(1.05);
	}
	
	/* Edit form */
	.edit-form input, .edit-form textarea {
	    width: 100%;
	    margin-bottom: 12px;
	    padding: 10px;
	    border-radius: 6px;
	    border: 1px solid #ccc;
	}
	.edit-form label {
	    font-weight: bold;
	}
	.image-box {
	    position: relative;
	}
	.image-box img {
	    height: 120px;
	    border-radius: 6px;
	}
	.image-box button {
	    position: absolute;
	    top: 5px; right: 5px;
	    background: #e74c3c;
	    color: #fff;
	    border: none;
	    font-size: 12px;
	    padding: 3px 6px;
	    border-radius: 50%;
	    cursor: pointer;
	}
	
	/* Animations */
	@keyframes fadeIn {
	    from { opacity: 0; }
	    to { opacity: 1; }
	}
	@keyframes scaleUp {
	    from { transform: scale(0.85); opacity: 0; }
	    to { transform: scale(1); opacity: 1; }
	}
	@keyframes fadeUp {
	    from { transform: translateY(20px); opacity: 0; }
	    to { transform: translateY(0); opacity: 1; }
	}
	
	/* Mobile */
	@media (max-width: 600px) {
	    .project-card img { height: 160px; }
	    .modal-content { width: 98%; height: 95%; border-radius: 8px; }
	    .image-preview img { height: 120px; }
	}
	#spinnerOverlay {
	           position: fixed;
	           top: 0; left: 0;
	           width: 100%; height: 100%;
	           background: rgba(0,0,0,0.6);
	           display: none;
	           align-items: center;
	           justify-content: center;
	           z-index: 1000;
	       }
	       .spinner {
	           border: 6px solid #f3f3f3;
	           border-top: 6px solid #3498db;
	           border-radius: 50%;
	           width: 60px; height: 60px;
	           animation: spin 1s linear infinite;
	       }
	       @keyframes spin { 100% { transform: rotate(360deg); } }

	       /* Success overlay */
	       #successOverlay {
	           position: fixed;
	           top: 0; left: 0;
	           width: 100%; height: 100%;
	           background: rgba(0,0,0,0.6);
	           display: none;
	           align-items: center;
	           justify-content: center;
	           z-index: 1001;
	           color: #fff;
	           font-size: 24px;
	           font-weight: bold;
	       }
	       .success-box {
	           background: #2ecc71;
	           padding: 20px 40px;
	           border-radius: 10px;
	       }
	</style>
	</head>
	<body>
	
	<div class="project-grid" id="projectGrid">
	    <!-- Projects dynamically loaded -->
	</div>
	
	<!-- View Project Modal -->
	<div class="modal" id="viewModal">
	    <div class="modal-content">
	        <button class="close-btn" onclick="closeModal('viewModal')">‚úñ Close</button>
	        <h2 id="viewTitle"></h2>
	        <div id="viewImages" class="image-preview"></div>
	        <p><strong>üìç Location:</strong> <span id="viewLocation"></span></p>
	        <p><strong>üìê Area:</strong> <span id="viewArea"></span></p>
	        <p><strong>üìù Description:</strong> <span id="viewDescription"></span></p>
	        <button class="edit-btn" onclick="switchToEdit()">Edit This Project</button>
	    </div>
	</div>
	<div id="spinnerOverlay">
	       <div class="spinner"></div>
	   </div>

	   <!-- Success -->
	   <div id="successOverlay">
	       <div class="success-box">‚úÖ Update Successful!</div>
	   </div>
	<!-- Edit Project Modal -->
	<div class="modal" id="editModal">
	    <div class="modal-content">
	        <button class="close-btn" onclick="closeModal('editModal')">‚úñ Close</button>
	        <h2>Edit Project</h2>
	        <form id="editProjectForm" class="edit-form">
	            <input type="hidden" id="projectId">
	
	            <label>Project Name:</label>
	            <input type="text" id="projectName">
	            
				<label>ProjectType:</label>
				<input type="text" id="projectType">

	            <label>Location:</label>
	            <input type="text" id="projectLocation">
				
	
	            <label>Area:</label>
	            <input type="text" id="projectArea">
	
	            <label>Description:</label>
	            <textarea id="projectDescription"></textarea>
	
	            <label>Existing Images:</label>
	            <div class="image-preview" id="editImages"></div>
	
	            <label>Add More Images:</label>
	            <input type="file" id="newImages" multiple>
	
	            <button type="button" onclick="saveProject()" style="background:#2ecc71;color:white;padding:10px 14px;border:none;border-radius:6px;cursor:pointer;">Save Changes</button>
	        </form>
	    </div>
	</div>
	
	<script>
	// Fetch projects
	fetch('/projects/list')
	    .then(res => res.json())
	    .then(projects => {
	        const grid = document.getElementById('projectGrid');
	        projects.forEach(project => {
	            let card = document.createElement('div');
	            card.classList.add('project-card');

	            const firstImage = project.images.length > 0
	                ? `/uploads/${project.images[0].imagePath}`
	                : 'https://via.placeholder.com/400x250?text=No+Image';

	            card.innerHTML = `
	                <img src="${firstImage}" alt="${project.name}">
	                <div class="project-title">${project.name}</div>
	                <div class="card-actions">
	                    <button class="view-btn" onclick='openViewModal(${JSON.stringify(project)})'>View</button>
	                    <button class="edit-btn" onclick='openEditModal(${JSON.stringify(project)})'>Edit</button>
	                    <button class="delete-btn" onclick="deleteProject(${project.id})">Delete</button>
	                </div>
	            `;
	            grid.appendChild(card);
	        });
	    });

	// View Modal
	let currentProject = null;
	function openViewModal(project) {
	    document.getElementById('viewTitle').textContent = project.name;
	    document.getElementById('viewLocation').textContent = project.location || "Not Available";
	    document.getElementById('viewArea').textContent = project.area || "Not Available";
	    document.getElementById('viewDescription').textContent = project.description || "No description available.";

	    let imgDiv = document.getElementById('viewImages');
	    imgDiv.innerHTML = project.images
	        .map(img => `<img src="/uploads/${img.imagePath}">`)
	        .join('');

	    document.getElementById('viewModal').style.display = 'flex';
	    currentProject = project;
	}

	// Edit Modal
	function switchToEdit() {
	    closeModal('viewModal');
	    openEditModal(currentProject);
	}
	function openEditModal(project) {
	    document.getElementById("projectId").value = project.id;
	    document.getElementById("projectName").value = project.name;
	    document.getElementById("projectType").value = project.projectType;
	    document.getElementById("projectLocation").value = project.location || "";
	    document.getElementById("projectArea").value = project.area || "";
	    document.getElementById("projectDescription").value = project.description || "";

	    let imgDiv = document.getElementById("editImages");
	    imgDiv.innerHTML = "";
	    project.images.forEach(img => {
	        let div = document.createElement("div");
	        div.classList.add("image-box");
	        div.innerHTML = `
	            <img src="/uploads/${img.imagePath}">
	            <button type="button" onclick="deleteImage(${project.id}, '${img.imagePath}', this)">x</button>
	        `;
	        imgDiv.appendChild(div);
	    });

	    document.getElementById('editModal').style.display = 'flex';
	}

	// Close Modal
	function closeModal(id) {
	    document.getElementById(id).style.display = 'none';
	}

	// Save Project (Add/Update)
	// Save Project (Add/Update)
	function saveProject() {
	    let id = document.getElementById("projectId").value;
	    let formData = new FormData();
	    if (id) formData.append("id", id);
	    formData.append("name", document.getElementById("projectName").value);
	    formData.append("projectType", document.getElementById("projectType").value);
	    formData.append("location", document.getElementById("projectLocation").value);
	    formData.append("area", document.getElementById("projectArea").value);
	    formData.append("description", document.getElementById("projectDescription").value);

	    let files = document.getElementById("newImages").files;
	    for (let i = 0; i < files.length; i++) {
	        formData.append("images", files[i]);
	    }

	    // ‚úÖ Show spinner overlay
	    document.getElementById("spinnerOverlay").style.display = "flex";
	    fetch(`/projects/save`, { method: "POST", body: formData })
	        .then(res => {
	            if (!res.ok) throw new Error("Failed to update");
	            return res.text();
	        })
	        .then(msg => {
	            // ‚úÖ Hide spinner
	            document.getElementById("spinnerOverlay").style.display = "none";
	            // ‚úÖ Show success overlay
	            document.getElementById("successOverlay").style.display = "flex";

	            setTimeout(() => {
	                document.getElementById("successOverlay").style.display = "none";
	                location.reload();
	            }, 2000);
	        })
	        .catch(err => {
	            document.getElementById("spinnerOverlay").style.display = "none";
	            alert("Error: " + err.message);
	        });
	}


	// Delete Project
	function deleteProject(id) {
	    if (confirm("Are you sure?")) {
	        fetch(`/projects/${id}`, { method: "DELETE" })
	            .then(res => {
	                if (res.ok) {
	                    alert("Deleted!");
	                    location.reload();
	                }
	            });
	    }
	}

	// Delete Image
	function deleteImage(projectId, imgPath, btn) {
	    if (confirm("Delete this image?")) {
	        fetch(`/projects/${projectId}/deleteImage?path=${encodeURIComponent(imgPath)}`, { method: "DELETE" })
	            .then(res => {
	                if (res.ok) {
	                    btn.parentElement.remove();
	                }
	            });
	    }
	}
	</script>

	</body>
    <div th:replace="fragments/footer :: site-footer"></div>
	</html>